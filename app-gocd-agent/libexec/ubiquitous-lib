#
# Ubiquitous Moodle
#
# @author Luke Carrier <luke@carrier.im>
# @copyright 2016 Luke Carrier
#

set -euo pipefail
IFS=$'\n\t'

UBIQUITOUS_PLATFORMS=/usr/local/ubiquitous/etc/ubiquitous-platforms

require_root() {
    if [ "$USER" != "root" ]; then
        echo "you must be root"
        exit 1
    fi
}

require_domain() {
    local domain=''
    eval set -- "$(getopt -o "d:" --long "domain:" -- "$@")"
    while true; do
        case "$1" in
            -d|--domain) domain="$2" ; shift 2 ;;
            *          ) break       ;         ;;
        esac
    done

    if [ -z "$domain" ]; then
        echo "you must supply a --domain" >&2
        exit 1
    fi

    set +e
    raw="$(grep -E "^${domain}:" "$UBIQUITOUS_PLATFORMS")"
    if [ $? -ne 0 ]; then
        echo "supplied --domain '${domain}' doesn't exist" >&2
        exit 1
    fi
    set -e

    user="$(echo "$raw" | cut -d: -f2)"
    htdocs="$(echo "$raw" | cut -d: -f3)"
}
